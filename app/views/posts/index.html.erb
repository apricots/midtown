<style>
	html, body #main{
		height: 100%;
	}

	.search-container {
		width: 30%;
		height: 100%;
		float: left;
		padding: 0 20px;
		-webkit-box-sizing: border-box;
	    -moz-box-sizing: border-box;
	    box-sizing: border-box;
	}	

	.map-container {
		position: relative;
		width: 70%;
		height: 100%;
		float: left;
	}

	.simpleGeocoder .esriGeocoderContainer {
		width: 100%;
		margin-bottom: 10px;
	}

	.simpleGeocoder .esriGeocoder {
		position: relative;
	}

	.simpleGeocoder .esriGeocoder .esriGeocoderSearch {
		position: absolute;
	}

	.simpleGeocoder .esriGeocoderHasValue .esriGeocoderReset {
		position: absolute;
		right: 0;
	}

	.simpleGeocoder .esriGeocoderContainer input[type=text] {
		width: 100%;
		-webkit-box-sizing: border-box;
	    -moz-box-sizing: border-box;
	    box-sizing: border-box;
	    padding: 16px 6px 16px 32px;
	    margin: 0;
	}

	.friends-container ul {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.friends-container .friend-container {
		display: block;
		margin-bottom: 5px;
	}

	.friends-container .friend {
		padding: 10px;
		border: 1px solid black;
		border-radius: 4px;
	}

	#MapDiv {

	}

	#Map {
		padding: 0;
      	margin: 0;
      	height: 100%;
	}
	#LocateButton {
      position: absolute;
      top: 95px;
      left: 20px;
      z-index: 50;
    }


</style>

<div class="search-container">
	<div class="search-collection">
		<div id="pointA"></div>
		<div id="pointB"></div>	
		<%# This is auto generated %>
	</div>

	<div class="friends-container">
		<h3>friends</h3>
		<ul>
			<% for user in current_user.friends %>
				<li>
					<a class="friend-container" href="#" data-username="<%= user.username %>">
						<div class="friend">
							<div><strong><%= user.username %></strong></div>
							<% if(user.address != nil)  %>
								<div><span><%= user.address %></span></div>
							<% end %>
						</div>
					</a>
				</li>
			<% end %>
		</ul>
	</div>
</div>

<div class="map-container">
    <div id="Map">
	    <div id="LocateButton"></div>
	</div>
</div>

<script>
	var geocoders = [];
	var searchContainer = $(".search-collection");

	var map;

  	require([
  		"dojo/dom",
		"dojo/_base/array",
		"esri/Color",
		"dojo/parser",
		"dijit/registry",

		"esri/dijit/Geocoder",
		"esri/dijit/LocateButton",

		"esri/urlUtils",
		"esri/map",
		"esri/lang",
		"esri/graphic",
		"esri/InfoTemplate",
		"esri/layers/GraphicsLayer",
		"esri/renderers/SimpleRenderer",

		"esri/geometry/Point",
		"esri/tasks/FeatureSet",

		"esri/tasks/ClosestFacilityTask",
		"esri/tasks/ClosestFacilityParameters",

		"esri/symbols/SimpleMarkerSymbol",
		"esri/symbols/SimpleLineSymbol",

		"dijit/form/ComboBox",
		"dijit/layout/BorderContainer",
		"dijit/layout/ContentPane"], function(
			dom, array, Color, parser, registry,
			Geocoder, LocateButton,
			urlUtils, Map, esriLang, Graphic, InfoTemplate, GraphicsLayer, SimpleRenderer, 
      		Point, FeatureSet, 
      		ClosestFacilityTask, ClosestFacilityParameters, 
      		SimpleMarkerSymbol, SimpleLineSymbol) { 
	    map = new Map("Map", {
	      center: [-56.049, 38.485],
	      zoom: 4,
	      basemap: "streets"
	    });

		var geoLocate = new LocateButton({
        	map: map
      	}, "LocateButton");
      	geoLocate.startup();

	    addGeocoder("pointA", "Your Address");
	    addGeocoder("pointB", "Friends Address");

		$("a.friend-container").each(function() {
			$(this).unbind("click").click(function() {
				var username = $(this).attr("data-username");
				searchContainer.append('<div id="point' + username + '"></div>');
				addGeocoder("point" + username, username);
				return false;
			});
		});

		function addGeocoder(id, detail) {
			var geocoder = new Geocoder({
				autoComplete: true,
				map: map,
	  			arcgisGeocoder: {
	    			placeholder: detail
	  			}
			}, dom.byId(id));
			geocoders.push(geocoder)
		}
	});     

</script>



